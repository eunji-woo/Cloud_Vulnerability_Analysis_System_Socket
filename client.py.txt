#!/usr/bin/python3
import socket
import os
import pymysql

db = pymysql.connect(host = "localhost", port = 3306, user = "root", password = "toor", database = "bbomain", charset = 'utf8')
cursor = db.cursor()
sql = "SELECT vuln_shell_code FROM vuln_shell_list"
cursor.execute(sql)
result = cursor.fetchall()

for record in result:
    os.system(record[0])
db.close()

ip = '172.31.45.126'
port = 9999

client = socket.socket()
client.connect((ip, port))
print("connected with server")

filename = "result.log"
data_transferred = 0
print("파일 %s 전송 시작" %filename)
with open(filename, 'rb') as f:
    try:
        data = f.read(1024)
        while data:
            data_transferred += client.send(data)
            data = f.read(1024)
            print(data)
    except Exception as ex:
        print(ex)
print("result.log 전송완료 %s, 전송량 %d" %(filename, data_transferred))
client.close()
